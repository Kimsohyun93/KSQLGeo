
CREATE STREAM HOMES WITH (KAFKA_TOPIC='HOMES', PARTITIONS=1, REPLICAS=1) AS
  SELECT *, true "UNITY"
  FROM HOME;


CREATE STREAM SCHOOLS (NAME STRING, UNITY BOOLEAN, WKT STRING)
WITH (KAFKA_TOPIC='SCHOOLS', VALUE_FORMAT='JSON', PARTITIONS=1, REPLICAS=1);


SELECT s.NAME, h.address, POINT_CONTAINED(h.LATITUDE, h.LONGITUDE, s.WKT) as CONTAINED
FROM HOMES h
LEFT JOIN SCHOOLS s WITHIN 1 days
ON s.UNITY = h.UNITY
WHERE POINT_CONTAINED(h.LATITUDE, h.LONGITUDE, s.WKT)
EMIT CHANGES;